<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-anatomy">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">How Lamby Works | Lamby - Simple Rails &amp; AWS Lambda Integration using Rack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lamby.cloud/docs/anatomy"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="rails, rack, lambda, serverless, containers"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How Lamby Works | Lamby - Simple Rails &amp; AWS Lambda Integration using Rack"><meta data-rh="true" name="description" content="The quickest way to see Lamby in action is to create a new Rails app via our cookiecutter project template using our  guide. This guide will instead outline what is happening within that starter project allowing you to cherry-pick which files and/or practices from our cookiecutter project can be applied to your own application(s)."><meta data-rh="true" property="og:description" content="The quickest way to see Lamby in action is to create a new Rails app via our cookiecutter project template using our  guide. This guide will instead outline what is happening within that starter project allowing you to cherry-pick which files and/or practices from our cookiecutter project can be applied to your own application(s)."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lamby.cloud/docs/anatomy"><link data-rh="true" rel="alternate" href="https://lamby.cloud/docs/anatomy" hreflang="en"><link data-rh="true" rel="alternate" href="https://lamby.cloud/docs/anatomy" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Lamby - Simple Rails &amp; AWS Lambda Integration using Rack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Lamby - Simple Rails &amp; AWS Lambda Integration using Rack Atom Feed"><link rel="stylesheet" href="/assets/css/styles.79994124.css">
<link rel="preload" href="/assets/js/runtime~main.56063e3a.js" as="script">
<link rel="preload" href="/assets/js/main.2ff9d428.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/lamby-logo-small.png" alt="Lamby Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/lamby-logo-small.png" alt="Lamby Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Lamby</b></a><a class="navbar__item navbar__link" href="/docs/quick-start">Quick Start</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/anatomy">Documentation</a><a class="navbar__item navbar__link" href="/blog">Updates Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/rails-lambda/lamby" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/anatomy">How Lamby Works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cpu">CPU Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/environment">ENV Variables &amp; Secrets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/database">Database &amp; VPCs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/assets">JavaScript &amp; Assets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/observability">Logging &amp; Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/activejob">ActiveJob &amp; Background Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/running-tasks">Running Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/custom-domain">Custom Domain Names</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/webservers">Web Proxy Integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cold-starts">Cold Starts</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How Lamby Works</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How Lamby Works</h1><p>The quickest way to see Lamby in action is to create a new Rails app via our cookiecutter project template using our <a href="/docs/quick-start">Quick Start</a> guide. This guide will instead outline what is happening within that starter project allowing you to cherry-pick which files and/or practices from our <a href="https://github.com/rails-lambdagithub.com/rails-lambda/lamby-cookiecutter" target="_blank" rel="noopener noreferrer">cookiecutter</a> project can be applied to your own application(s).</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>If you copy any template files without using the cookiecutter, remember to customize the <code>{% include ... %}</code> template sections with your own app name and remove the curly bracket sections like these <code>{{ &quot;...&quot; }}</code> from various string literals.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a class="hash-link" href="#architecture" title="Direct link to heading">​</a></h2><p>Lamby is a Rack adapter that converts AWS Lambda integration events into native <a href="https://github.com/rack/rack/blob/master/SPEC.rdoc" target="_blank" rel="noopener noreferrer">Rack Environment</a> objects which are sent directly to your application. Lamby can automatically do this when using either Lambda Function URLs, API Gateway HTTP API v1/v2 payloads, API Gateway REST API, or even Application Load Balancer (ALB) integrations.</p><p>Since Rails applications are Rack applications, Lamby removes the need for a companion <a href="https://github.com/rack/rack#supported-web-servers" target="_blank" rel="noopener noreferrer">Rack Web Server</a> like Passenger or Puma to be running within your container. Essentially AWS integrations become your web server and scaling is managed by the Lambda service spinning up new container instances, one for each request or down to zero if needed. Lambda instances live for several minutes or more. A small pool of concurrent fuctions can handle a large amount of traffic.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-lamby">Install Lamby<a class="hash-link" href="#install-lamby" title="Direct link to heading">​</a></h2><p>Start by adding the Lamby gem to your <code>Gemfile</code>. It remains inert until it detects special environment variables present when run on AWS Lambda. When activated, it mostly does a few simple things like ensuring Rails logs to standard out.</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gem </span><span class="token string-literal string" style="color:#e3116c">&#x27;lamby&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-container">Runtime Container<a class="hash-link" href="#runtime-container" title="Direct link to heading">​</a></h2><p>You will need some <a href="https://github.com/rails-lambda/lamby-cookiecutter/blob/master/%7B%7Bcookiecutter.project_name%7D%7D/Dockerfile" target="_blank" rel="noopener noreferrer"><code>Dockerfile</code></a> to build your Lambda container image. Referencing architecture diagram above mentions something called a RIC (Rick). The RIC is short for the Lambda <a href="https://github.com/aws/aws-lambda-ruby-runtime-interface-client" target="_blank" rel="noopener noreferrer">Runtime Interface Client</a>. It is a small interface packaged as a Ruby gem that acts as the <code>ENTRYPOINT</code> for any <a href="https://opencontainers.org" target="_blank" rel="noopener noreferrer">OCI</a> continer image to run on the AWS Lambda platform. Below you can see that we are using an <a href="https://hub.docker.com/_/ruby" target="_blank" rel="noopener noreferrer">Official Ruby</a> Ubuntu variant base image, installing the RIC and setting it as the entrypoint.</p><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Dockerfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> ruby:3.2-bullseye</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> gem install </span><span class="token instruction string" style="color:#e3116c">&#x27;aws_lambda_ric&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENTRYPOINT</span><span class="token instruction"> [ </span><span class="token instruction string" style="color:#e3116c">&quot;/usr/local/bundle/bin/aws_lambda_ric&quot;</span><span class="token instruction"> ]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:#e3116c">&quot;config/environment.Lamby.cmd&quot;</span><span class="token instruction">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The RIC allows us to use Docker&#x27;s <code>CMD</code> to load Rails and invoke a function. In this case we are loading our Rails application through its <code>config/environment.rb</code> file (.rb extension is implied) and once that is done, calling the <code>Lamby.cmd</code> as the Lambda handler.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Our <a href="https://github.com/rails-lambda/lamby-cookiecutter" target="_blank" rel="noopener noreferrer">cookiecutter</a> project defaults to building a Linux image targeting the <code>arm64</code> architecture vs the traditional <code>x86_64</code>. However, this is easily changed to accomodate your needs. Check out the <a href="/docs/cpu">CPU Architecture</a> section for more details.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sam-cloudformation-file">SAM CloudFormation File<a class="hash-link" href="#sam-cloudformation-file" title="Direct link to heading">​</a></h2><p>The <a href="https://github.com/rails-lambda/lamby-cookiecutter/blob/master/%7B%7Bcookiecutter.project_name%7D%7D/template.yaml" target="_blank" rel="noopener noreferrer"><code>template.yaml</code></a> file at the root of your project describes your <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html" target="_blank" rel="noopener noreferrer">Serverless Application</a>. Don&#x27;t worry, we have done some heavy lifting for you. Here is the <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html" target="_blank" rel="noopener noreferrer">Serverless Function</a> Resource we start you off with and a brief explanation:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">template.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">RailsLambda</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AWS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Serverless</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">DockerContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Dockerfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">DockerTag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">AutoPublishAlias</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> live</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">FunctionUrlConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">AuthType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">DeploymentPreference</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AllAtOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">MemorySize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1792</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">PackageType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Your Rails function will have a <code>MemorySize</code> of 1,792 MB of RAM and 1 vCPU. This is the sweet spot for Rails speed and cost optimization. Remember, you&#x27;re not running a web server in a single function nor scaling by memory.</li><li>The <code>FunctionUrlConfig</code> has been configured to be a public HTTP proxy. You can change this to IAM authentication or swap out to other web server integrations like API Gateway if you need their features. Details in other guides.</li><li>The maximum amount of <code>Timeout</code> for an HTTP integration is 30 seconds.</li></ul><img loading="lazy" alt="AWS SAM Introduction" src="/assets/images/aws_sam_introduction-590ef90646d8fd6b180de45a8a3b554d.png" style="width:100%;border-radius:5px;margin-bottom:0.5rem" class="img_ev3q"><p>As your application grows you may end up adding Resources like EventBridge Rules, SQS, S3 Buckets, and IAM Policies. Please take some time to learn how SAM &amp; CloudFormation work.</p><ul><li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html" target="_blank" rel="noopener noreferrer">What Is the AWS Serverless Application Model (AWS SAM)?</a></li><li><a href="https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md" target="_blank" rel="noopener noreferrer">Quick Intro &amp; Tech Spec for SAM File</a></li><li><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html" target="_blank" rel="noopener noreferrer">What is AWS CloudFormation?</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="development-container">Development Container<a class="hash-link" href="#development-container" title="Direct link to heading">​</a></h2><p>Described in the <a href="/docs/quick-start">Quick Start</a> guide, our Lamby starter makes use of the <a href="https://containers.dev" target="_blank" rel="noopener noreferrer">Development Container</a> specification via a <a href="https://github.com/rails-lambda/lamby-cookiecutter/tree/master/%7B%7Bcookiecutter.project_name%7D%7D/.devcontainer" target="_blank" rel="noopener noreferrer"><code>.devcontainer</code></a> directory. Commonly used with Codespaces, dev containers can be used locally with any editor.</p><p>Our dev container&#x27;s <code>Dockerfile</code> uses the same base image as the one at the root of your project. This helps ensure your development experience, like installing system dependencies and Ruby gems with native extensions, aligns with the same process as your production image.</p><p>We also leverage the devcontainer&#x27;s <code>dockerComposeFile</code> capability to include a MySQL service as well. The Lamby starter also includes a range of <a href="https://containers.dev/features" target="_blank" rel="noopener noreferrer">devcontainer features</a> which are installed within the Ubuntu development image. For example, Node, Docker in Docker, SSH, and the AWS CLI &amp; SAM CLI.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Technically you do not need to adopt these devcontainer patterns, but it is really nice to be able to use this container to ensure your CI/CD process is reproducable locally using VS Code or the <a href="https://github.com/devcontainers/cli" target="_blank" rel="noopener noreferrer">Dev Container CLI</a>. More details in the following CI/CD section.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment--cicd">Deployment &amp; CI/CD<a class="hash-link" href="#deployment--cicd" title="Direct link to heading">​</a></h2><p>So how does that CloudFormation file and container image get created within AWS? We use the AWS SAM CLI&#x27;s <code>build</code>, <code>package</code>, and <code>deploy</code> commands in a single <a href="https://github.com/rails-lambda/lamby-cookiecutter/blob/master/%7B%7Bcookiecutter.project_name%7D%7D/bin/deploy" target="_blank" rel="noopener noreferrer"><code>bin/deploy</code></a> file. This file also does the following. Feel free to customize your deploy files as needed:</p><ul><li>Finds/Creates an ECR repository with the same name as your project.</li><li>Sets various ENV variables if not set already. For example, easy to deploy to multiple regions by setting <code>AWS_REGION</code>.</li><li>Install gems into local vendor/bundle for deployment via a Docker <code>COPY</code>.</li></ul><p>If you used our <a href="/docs/quick-start">Quick Start</a> guide, you likely made your first deploy using VS Code&#x27;s integrated terminal within the development container. This is critically important since your Ruby gems with native extensions are built within the context of the Ruby Ubuntu image being built and copied to ECR for Lambda to use.</p><p>When automating deployments, the system must have permission to create the needed resources and IAM Roles with permission(s) for your application to work. Most hobby users have admin level access to their own AWS account. For more security minded folks, consider creating a <a href="https://docs.aws.amazon.com/lambda/latest/dg/access-control-identity-based.html" target="_blank" rel="noopener noreferrer">least privilege user</a> for your deployments with <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html" target="_blank" rel="noopener noreferrer">OpenID Connect</a> identity providers. We found that the <code>AWSCodeDeployFullAccess</code> managed policy is often overlooked.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="circleci">CircleCI<a class="hash-link" href="#circleci" title="Direct link to heading">​</a></h3><p>If <code>arm64</code> is your target platform in production, CircleCI make it easy to to do so using their <a href="https://circleci.com/docs/using-arm/" target="_blank" rel="noopener noreferrer">Arm Execution Environment</a>. Our starter includes a CircleCI <code>config.yml</code> file that runs tests on each commit or deploy by manually triggering a workflow. It even uses the <a href="https://github.com/devcontainers/cli" target="_blank" rel="noopener noreferrer">Devcontainer CLI</a> to ensure your CI/CD matches your development experience. Changing between <code>arm64</code> and <code>x86_64</code> is described in our <a href="/docs/cpu">CPU Architecture</a> guide.</p><ul><li><a href="https://github.com/rails-lambda/lamby-cookiecutter/blob/master/%7B%7Bcookiecutter.project_name%7D%7D/.circleci/config.yml" target="_blank" rel="noopener noreferrer">Test &amp; Deploy CircleCI Template</a></li></ul><p>Deploying requires manually triggering the workflow. Simply select a branch then click &quot;Trigger Workflow&quot; and pass a string parameter called &quot;workflow&quot; with a value of &quot;deploy&quot;. Feel free to change this workflow to suite your needs.</p><img src="/img/docs/circle-ci-trigger-workflow-light.png" alt="CircleCI Trigger Workflow for Deploy" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/docs/circle-ci-trigger-workflow-dark.png" alt="CircleCI Trigger Workflow for Deploy" class="themedImage_ToTc themedImage--dark_i4oU"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions">GitHub Actions<a class="hash-link" href="#github-actions" title="Direct link to heading">​</a></h3><p>You can automate both the test and deploy process using our provided GitHub Actions which also leverage the <a href="https://github.com/devcontainers/ci" target="_blank" rel="noopener noreferrer">Dev Container Build and Ruby CI</a> project.</p><ul><li><a href="https://github.com/rails-lambda/lamby-cookiecutter/blob/master/%7B%7Bcookiecutter.project_name%7D%7D/.github/workflows/deploy.yml" target="_blank" rel="noopener noreferrer">Deploy GitHub Action Template</a></li><li><a href="https://github.com/rails-lambda/lamby-cookiecutter/blob/master/%7B%7Bcookiecutter.project_name%7D%7D/.github/workflows/test.yml" target="_blank" rel="noopener noreferrer">Test GitHub Action Template</a></li></ul><ol><li>Within your project&#x27;s GitHub repository <a href="https://docs.github.com/en/actions/reference/encrypted-secrets" target="_blank" rel="noopener noreferrer">add two Encrypted Secrets</a> using the credentials values above with the environment names of <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>.</li><li>If needed, change the <code>aws-region</code> in your <code>.github/workflows/deploy.yml</code> file from <code>us-east-1</code> to your own region.</li><li>Trigger a deploy by navigating to the Deploy workflow and clicking &quot;Run workflow&quot;.</li></ol><img loading="lazy" alt="Lambda &amp; Rails deploy with GitHub Actions" src="/assets/images/github-actions-deploy-44671ab963c8788ae816dec248ecfe76.png" style="width:100%;border-radius:5px" class="img_ev3q"></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rails-lambda/lamby-site/tree/master/docs/anatomy.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/quick-start"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Quick Start</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/cpu"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CPU Architecture</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#install-lamby" class="table-of-contents__link toc-highlight">Install Lamby</a></li><li><a href="#runtime-container" class="table-of-contents__link toc-highlight">Runtime Container</a></li><li><a href="#sam-cloudformation-file" class="table-of-contents__link toc-highlight">SAM CloudFormation File</a></li><li><a href="#development-container" class="table-of-contents__link toc-highlight">Development Container</a></li><li><a href="#deployment--cicd" class="table-of-contents__link toc-highlight">Deployment &amp; CI/CD</a><ul><li><a href="#circleci" class="table-of-contents__link toc-highlight">CircleCI</a></li><li><a href="#github-actions" class="table-of-contents__link toc-highlight">GitHub Actions</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Guides</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/anatomy">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/custominktech" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter @CustomInkTech<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://dev.to/customink" target="_blank" rel="noopener noreferrer" class="footer__link-item">Technology Blog on Dev.to<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Lamby Blog</a></li><li class="footer__item"><a href="https://github.com/rails-lambda/lamby" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Project<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">2023 - Made with ❤️ by Custom Ink | Tech</div></div></div></footer></div>
<script src="/assets/js/runtime~main.56063e3a.js"></script>
<script src="/assets/js/main.2ff9d428.js"></script>
</body>
</html>